<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AO3 Mod Tools – Unrevealed Multi-page Export</title>
  <style>
    :root {
      --ao3-red: #990000;
      --ao3-light: #f7f3f0;
      --border: #ddd;
      --text: #222;
    }
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
      background: #faf7f6;
      color: var(--text);
      margin: 0;
      padding: 2.5rem 1rem;
      display: flex;
      justify-content: center;
    }
    .card {
      background: white;
      max-width: 840px;
      width: 100%;
      padding: 2rem 2.2rem;
      border-radius: 10px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.08);
      border: 1px solid #e3d7cf;
    }
    h1 {
      font-size: 1.7rem;
      color: var(--ao3-red);
      margin: 0 0 0.6rem;
    }
    h2 {
      font-size: 1.2rem;
      margin: 1.4rem 0 0.4rem;
      color: #444;
    }
    p {
      margin: 0.3rem 0;
    }
    .badge {
      display: inline-block;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: var(--ao3-light);
      color: var(--ao3-red);
      padding: 0.2rem 0.55rem;
      border-radius: 999px;
      border: 1px solid #e2d2ca;
      margin-bottom: 0.6rem;
    }
    .bookmarklet {
      display: inline-block;
      margin: 0.8rem 0 1.2rem;
      padding: 0.55rem 1.2rem;
      border-radius: 999px;
      background: var(--ao3-red);
      color: #fff;
      font-weight: 600;
      font-size: 0.95rem;
      text-decoration: none;
      border: 1px solid #5f0000;
      box-shadow: 0 4px 10px rgba(153,0,0,0.25);
      cursor: grab;
    }
    .bookmarklet:hover {
      background: #b30000;
    }
    .bookmarklet:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(153,0,0,0.3);
      cursor: grabbing;
    }
    ol {
      padding-left: 1.2rem;
      margin: 0.25rem 0 0.8rem;
    }
    li { margin: 0.15rem 0; }
    code {
      background: #f5f2ef;
      padding: 0.1rem 0.25rem;
      border-radius: 4px;
      font-size: 0.85rem;
    }
    textarea {
      width: 100%;
      height: 7rem;
      margin-top: 0.4rem;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 0.78rem;
      padding: 0.45rem;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: #fdfaf8;
      resize: vertical;
    }
    .note {
      font-size: 0.85rem;
      color: #555;
    }
    .footer {
      margin-top: 1.4rem;
      padding-top: 0.8rem;
      border-top: 1px dashed #e0d0c6;
      font-size: 0.8rem;
      color: #777;
    }
    ul {
      margin: 0.25rem 0 0.8rem;
      padding-left: 1.2rem;
    }
    ul li {
      margin: 0.15rem 0;
    }
  </style>
</head>
<body>
  <main class="card">
    <span class="badge">AO3 Collection Moderator Tool</span>
    <h1>Unrevealed Multi-page Export</h1>
    <p>
      This bookmarklet helps collection moderators export all <strong>Approved</strong> items
      from the AO3 “Manage Items” view into a single CSV file – even if there are
      many pages of items.
    </p>
    <p>
      It walks through all pages of the Approved tab and, for non-draft works,
      also visits each work page to fetch fandom, tags, rating, and other details.
      You can then open the CSV in Excel, Google Sheets, or LibreOffice to plan
      reveals, check assignments, or do any other modly spreadsheets you need.
    </p>

    <h2>What this script actually does</h2>
    <p>For every item listed in <strong>Manage Items → Approved</strong>, the export will include:</p>
    <ul>
      <li><strong>Title</strong> – exactly as shown in the Approved list (including “(Draft)” if present)</li>
      <li><strong>Is Draft</strong> – <code>yes</code> if the title ends with <code>(Draft)</code>, otherwise empty</li>
      <li><strong>Creator</strong> – the name shown in the header line (without the “for &lt;recipient&gt;” part)</li>
      <li><strong>Link</strong> – direct link to the work on AO3</li>
      <li><strong>Recipient</strong> – the giftee / recipient, if present</li>
      <li><strong>Posting Date</strong> – the date shown in the Approved list</li>
      <li><strong>creator_status</strong> – e.g. “Approved by creator”</li>
      <li><strong>collection_status</strong> – e.g. “Approved by collection moderators”</li>
      <li><strong>unrevealed</strong> – <code>unrevealed</code> if the checkbox is ticked, otherwise <code>revealed</code></li>
      <li><strong>Fandoms</strong> – all fandom tags from the work page</li>
      <li><strong>Category</strong> – Gen / F/M / M/M / F/F etc.</li>
      <li><strong>Relationships</strong></li>
      <li><strong>Characters</strong></li>
      <li><strong>Tags</strong> – the additional tags / freeforms</li>
      <li><strong>Rating</strong></li>
      <li><strong>Warnings</strong></li>
      <li><strong>Words</strong></li>
      <li><strong>Chapters</strong> – preserved with the current <code>="current/total"</code> style</li>
      <li><strong>Summary</strong> – the work summary text (without an extra “Summary:” prefix)</li>
    </ul>
    <p class="note">
      This export deliberately does <em>not</em> include kudos, comments, bookmarks, or hits.
      For unrevealed items, those numbers are not meaningful yet; you can run a different
      export later after reveals.
    </p>

    <h2>Drafts and weird AO3 behaviour</h2>
    <p>
      Drafts on AO3 can show up in the collection “Manage Items” view even when you,
      as a mod, can’t actually load the work page. These are identified by
      AO3 with <code>(Draft)</code> at the end of the title.
    </p>
    <ul>
      <li>The script marks such entries with <strong>Is Draft = yes</strong>.</li>
      <li>For drafts, it <strong>does not try to fetch work-page metadata</strong> (fandoms, tags, etc.).</li>
      <li>This prevents accidentally pulling in wrong or error-page data.</li>
      <li>Drafts may appear multiple times if an author saves several drafts; the CSV will reflect that, so you can deduplicate or track them as needed.</li>
    </ul>

    <h2>Drag-and-drop bookmarklet</h2>
    <p>Drag this button to your bookmarks bar:</p>

    <!-- SHORT LOADER BOOKMARKLET -->
    <p>
      <a class="bookmarklet"
         href="javascript:(function(){var s=document.createElement('script');s.src='https://larissabernstein.github.io/ao3_mod_tools_unrevealed.js?'+Date.now();document.body.appendChild(s);}());">
        AO3 Unrevealed – All Pages CSV
      </a>
    </p>

    <p class="note">
      When clicked on AO3, this bookmarklet loads the latest version of the
      export script from this site and downloads a CSV file.
    </p>

    <h2>How to use on AO3</h2>
    <ol>
      <li>Log in to AO3 and go to your collection’s <strong>Manage Items</strong> page.</li>
      <li>Click the <strong>Approved</strong> tab (with the status dropdowns &amp; unrevealed checkboxes).</li>
      <li>Make sure you are on <strong>page&nbsp;1</strong> of the Approved list.</li>
      <li>Click the <em>AO3 Unrevealed – All Pages CSV</em> bookmarklet.</li>
      <li>Wait while it walks through all pages and non-draft work pages; when finished, a CSV will download as<br>
        <code>ao3_mod_unrevealed_work_info_all_pages.csv</code>.
      </li>
    </ol>

    <h2>If dragging doesn’t work (Safari fallback)</h2>
    <p>
      If clicking the bookmark on AO3 does nothing, Safari may have mangled the code.
      In that case:
    </p>
    <ol>
      <li>Create a new bookmark (e.g. name it <code>AO3 Unrevealed – All Pages CSV</code>).</li>
      <li>Open <strong>Bookmarks → Edit Bookmarks</strong> and select the bookmark.</li>
      <li>Paste this into the URL / Address field and press Enter:</li>
    </ol>

    <textarea readonly>
javascript:(function(){var s=document.createElement('script');s.src='https://larissabernstein.github.io/ao3_mod_tools_unrevealed.js?'+Date.now();document.body.appendChild(s);}());
    </textarea>

    <p class="note">
      After that, use the bookmark on AO3 as described above.
    </p>

    <div class="footer">
      Version 1.1 – draft-aware unrevealed export.<br>
      Exports columns: Title, Is Draft, Creator, Link, Recipient, Posting Date,
      creator_status, collection_status, unrevealed, Fandoms, Category,
      Relationships, Characters, Tags (freeforms), Rating, Warnings, Words,
      Chapters, Summary (no kudos/comments/bookmarks/hits).<br>
      Created by Dr. Larissa Bernstein.
    </div>
  </main>
</body>
</html>